<!DOCTYPE html>
<html>

<head>
  <title>都道府県地図カルトグラム</title>
  <meta charset="utf-8">
  <meta property="og:image" content="placeholder.png">
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-9E4Y5K4DKT"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());

    gtag('config', 'G-9E4Y5K4DKT');
  </script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="docs/style.min.css">
</head>

<body>
  <main class="page container-fluid">
    <section class="card hero-card"
      style="display: flex; flex-direction: row; justify-content: space-between; align-items: center; gap: 1rem;">
      <div>
        <h1>都道府県地図カルトグラム</h1>
        <p style="margin-bottom: 0;">
          都道府県別データを CSV でアップロードして、面積をデータ値に比例させたカルトグラムをブラウザだけで生成できます。
        </p>
      </div>
      <div style="display: flex; gap: 0.5rem; flex-shrink: 0;">
        <button class="btn btn-secondary" id="load-project-btn" type="button">プロジェクト・ファイル読込</button>
        <button class="btn btn-secondary" id="download-project-btn" type="button">プロジェクト・ファイル保存</button>
      </div>
    </section>

    <div class="layout">
      <section class="card data-panel">
        <div class="panel-header">
          <h2>都道府県を選択</h2>
          <p> 表示する都道府県の地図を切り替えます。 </p>
        </div>
        <div class="field-group">
          <label class="form-label" for="map-select">都道府県</label>
          <select id="map-select" class="form-select" aria-label="都道府県を選択"></select>
        </div>
        <div class="panel-header">
          <h2>データ管理</h2>

          <p>
            CSV のキー列（選択した地図の名称列）を基準に、他の列を指標として利用します。アップロード後に内容を確認してからマップに適用できます。
          </p>
        </div>

        <div class="field-group">
          <h3>現在の適用データ</h3>
          <div class="current-status">
            <span class="status-value" id="current-data-label">サンプルデータ</span>
          </div>
          <button class="btn btn-tertiary" id="toggle-current-preview" type="button">
            表データを隠す
          </button>
          <div id="current-data-preview" class="data-preview"></div>
        </div>

        <ul class="nav nav-tabs nav-fill data-tabs" id="data-tabs" role="tablist">
          <li class="nav-item" role="presentation">
            <button class="nav-link active" id="sample-tab" data-bs-toggle="pill" data-bs-target="#sample-pane"
              type="button" role="tab" aria-controls="sample-pane" aria-selected="true">サンプル</button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link" id="upload-tab" data-bs-toggle="pill" data-bs-target="#upload-pane" type="button"
              role="tab" aria-controls="upload-pane" aria-selected="false">オリジナル</button>
          </li>
        </ul>

        <div class="tab-content" id="data-tab-content">
          <div class="tab-pane fade show active" id="sample-pane" role="tabpanel" aria-labelledby="sample-tab">
            <div class="field-group">
              <h3>サンプルデータ</h3>
              <p class="info-note">
                初期表示ではサンプルデータ（SSDSE-A の人口）を読み込んでいます。<br /><br />
                出典：<a href="https://www.nstac.go.jp/use/literacy/SSDSE/" target="_blank">独立行政法人 統計センター
                  SSDSE-C-2025</a>を加工して作成。<br /><br />データは2020年。
              </p>
              <div id="sample-data-preview" class="data-preview"></div>
              <div class="button-row wrap">
                <button class="btn btn-secondary" id="download-sample" type="button">ダウンロード</button>
                <button class="btn btn-secondary" id="download-data-csv" type="button">CSVダウンロード</button>
                <button class="btn btn-tertiary" id="reset-data" type="button">サンプルに戻す</button>
              </div>
            </div>
          </div>

          <div class="tab-pane fade" id="upload-pane" role="tabpanel" aria-labelledby="upload-tab">
            <div class="field-group">
              <h3>データアップロード</h3>
              <div id="dropzone" class="upload-area">
                <p class="title">CSV をドラッグ＆ドロップ</p>
                <p>または</p>
                <label class="file-input-label btn btn-secondary">
                  <input type="file" id="file-input" accept=".csv,text/csv">
                  ファイルを選択
                </label>
              </div>
              <p id="upload-status" class="help-text"></p>
            </div>

            <div id="preview" class="field-group is-hidden">
              <div class="section-header">
                <h3>アップロードプレビュー</h3>
              </div>
              <div id="preview-table" class="table-container"></div>
              <div id="preview-stats" class="preview-stats"></div>
              <button class="btn btn-primary full-width" id="apply-data" type="button" disabled>
                このデータを適用
              </button>
            </div>
          </div>
        </div>
      </section>

      <section class="card map-card" id="map-card">
        <div class="map-card-header">
          <div class="map-heading">
            <div class="map-select">
              <select id="field" aria-label="データ指標"></select>
              <div class="map-controls">
                <div class="unit-field">
                  <label for="legend-unit">単位</label>
                  <input id="legend-unit" type="text" maxlength="16" placeholder="例：円">
                </div>
                <select id="legend-cells" aria-label="凡例の色数">
                  <option value="3">3色</option>
                  <option value="4">4色</option>
                  <option value="5" selected>5色</option>
                  <option value="6">6色</option>
                  <option value="7">7色</option>
                </select>
                <select id="display-mode" aria-label="表示モード">
                  <option value="value" selected>実数モード</option>
                  <option value="ranking">ランキングモード</option>
                </select>
                <select id="color-scheme" aria-label="カラースキーム"></select>
                <label class="label-toggle" for="show-labels">
                  <input type="checkbox" id="show-labels" class="form-check-input">
                  <span>地名を表示</span>
                </label>
              </div>
            </div>
          </div>
        </div>
        <div id="map-container" class="map-frame">
          <svg id="map" viewBox="0 0 800 800" preserveAspectRatio="xMidYMid meet"></svg>
        </div>
        <div class="button-row stretch download-row">

          <button class="btn btn-secondary" id="download-svg-btn" type="button">SVGダウンロード</button>
          <button class="btn btn-secondary" id="download-png-btn" type="button">PNGダウンロード</button>
        </div>
      </section>
    </div>
  </main>
  <footer class="footer-links">
    <div class="links-container">
      <a href="https://www.dataviz.jp/" target="_blank" rel="noreferrer noopener">Dataviz.jp</a>
      <span class="divider">|</span>
      <a href="https://visualizing.jp/" target="_blank" rel="noreferrer noopener">Visualizing.JP</a>
    </div>
  </footer>

  <!-- Modal: Project List -->
  <div class="modal fade" id="projectListModal" tabindex="-1" aria-labelledby="projectListModalLabel"
    aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="projectListModalLabel">保存済みプロジェクト</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="list-group" id="project-list-group">
            <p class="text-center text-muted p-4">読み込み中...</p>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">閉じる</button>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://auth.dataviz.jp/lib/supabase.js"></script>
  <script src="https://auth.dataviz.jp/lib/dataviz-auth-client.js"></script>
  <script src="docs/app.min.js"></script>
</body>

</html>
